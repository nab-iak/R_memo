library package and import data
```{r}
library(tidyverse)
dt <- read.csv("~/PycharmProjects/R_memo/data/glue.csv")
dt <- dt %>%
  arrange(Model)
dt
```

wider the dataset
```{r}
dt_wider1 <- dt %>%
                pivot_wider(
                  id_cols = "Model",
                  names_from = c("Task","Encoder","Year"),
                  values_from = "Score",
                  names_sep="_"
                )
dt_wider1
```

restore the widerred dataset
while widering, some column with non-exist data(NA) will alse be included, 
so na.omit NAs to restore dataset
```{r}
dt_longer1 <- dt_wider1 %>%
                  pivot_longer(
                    cols = matches("_"),
                    names_to = c("Task","Encoder","Year"),
                    names_pattern = "(.*)_(.*)_(.*)", # pattern order is -> "Task","Encoder","Year"
                    values_to = "Score"
                  ) %>%
                  arrange(Model) %>%
                  na.omit()
dt_longer1
```

store the items of Task as columns
```{r}
dt_longer1_2 <- dt_wider1 %>%
                  pivot_longer(
                    cols = matches("_"),
                    names_to = c(".value","Encoder","Year"),
                    names_pattern = "(.*)_(.*)_(.*)"
                    # values_to = "Score" # The items of the task will be stored in the column 
                                          # so there is no need to create a column name for the score
                  ) %>%
                  arrange(Model) %>%
                  na.omit()
dt_longer1_2
```

wider two columns only
```{r}
dt_wider2 <- dt %>%
                pivot_wider(
                  id_cols = c("Model","Task"),
                  names_from = c("Encoder","Year"),
                  values_from = "Score",
                  names_sep="_"
                ) 
dt_wider2
```

restore the wriderred dataset
```{r}
dt_longer2 <- dt_wider2 %>%
                  pivot_longer(
                    cols = matches("_"),
                    names_to = c("Encoder","Year"),
                    names_pattern = "(.*)_(.*)",
                    values_to = "Score"
                  ) %>%
                  arrange(Model) %>%
                  na.omit()
dt_longer2
```

replace all NA in dt_wider2 into 0
```{r}
dt_wider2_na.rm <- dt_wider2 %>%
                        mutate_all(~replace_na(.,0)) %>%
                        arrange(Model,Task)
dt_wider2_na.rm
```

mutate a column meaning transformer in 2018 and 2019
```{r}
dt_wider2_na.rm %>%
            select(-c("LSTM_2017","LSTM_2018")) %>%
            mutate(
              across(
                contains("_2018"), 
                 ~ (. + get(sub("_2018", "_2019", cur_column())))/2, 
                .names = "{.col}_mean")
              ) %>%
            rename_with(
              ~ gsub("_2018_mean", "_mean", .), 
              contains("_2018_mean")
              ) %>%
            arrange(Model,Task)
```

another way to calculate mean by group_by()
```{r}
dt_wider2_na.rm_2 <- dt_wider2_na.rm %>%
                          select(-c(LSTM_2017, LSTM_2018)) %>%
                          pivot_longer(
                            cols = matches("_"),
                            names_to = c("Encode","Year"),
                            names_pattern = "(.*)_(.*)",
                            values_to = "Score"
                          ) 
dt_wider2_na.rm_2
dt_wider2_na.rm_2 %>%
  group_by(Model,Task,Encode) %>%
  summarize(
    mean_Score = mean(Score)
  ) 
```




